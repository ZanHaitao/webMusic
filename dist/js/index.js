!function(e,t){function s(){this.nowIndex=0,this.rotateTimer=null,this.wraper=t,this.progress=null}s.prototype={init:function(){this.getData(),this.getDom(),this.handle()},getData:function(){var s=this;$.ajax({url:"../mock/data.json",method:"get",success:function(t){s.musicData=t,s.musicList=new e.listRender(t,s.wraper),s.index=new e.index(t.length),e.render(t[s.nowIndex]),s.musicListInfo=s.musicList.render(),s.last=s.musicListInfo.musicList[0],s.changeList(),s.load(s.nowIndex)}})},getDom:function(){this.listBtn=document.querySelector(".control").children,this.rotateImg=document.querySelector(".songImg img"),this.rotateImg.dataset.deg=0,this.dragDom=document.querySelector(".circle"),this.frontBg=document.querySelector(".frontBg")},handle:function(){var t=this;this.playDom=this.listBtn[2],e.audio.end(function(){t.progress.stop(),t.index.next(),e.audio.status="play",t.load(t.index.get())});for(var s=0;s<this.listBtn.length;s++)this.listBtn[s].dataset.index=s,this.listBtn[s].addEventListener("touchend",function(){1==this.dataset.index&&(t.progress.stop(),t.index.prev(),e.audio.status="play",t.load(t.index.get())),3==this.dataset.index&&(t.progress.stop(),t.index.next(),e.audio.status="play",t.load(t.index.get())),2==this.dataset.index&&("play"===e.audio.status?(e.audio.pause(),e.audio.status="pause",this.className="",t.stopRotate(),t.progress.stop()):(e.audio.play(),e.audio.status="play",this.className="playing",t.rotate(),t.progress.start())),4==this.dataset.index&&t.musicList.slideUp()})},changeList:function(){var a=this;this.musicListInfo.musicList.forEach(function(t,s){t.addEventListener("touchend",function(){s!==a.index.get()&&(a.changeActive(t,s),a.musicList.slideDown(),e.audio.status="play",a.progress.stop(),a.load(a.index.get()))})})},changeActive:function(t,s){this.last&&(this.last.className=""),t.className="active",this.index.nowIndex=s,this.last=t},load:function(t){e.audio.load(this.musicData[t].audioSrc),e.render(this.musicData[t]),this.changeActive(this.musicListInfo.musicList[t],t),this.progress=e.progress.progress(this.musicData[t].duration),this.handleDrag(),"play"===e.audio.status&&(e.audio.play(),this.listBtn[2].className="playing",this.rotateImg.dataset.deg=0,this.rotate(),this.progress.start())},rotate:function(){var t,s;this.rotateTimer||(t=0,(s=this).rotateTimer=setInterval(function(){t=+s.rotateImg.dataset.deg+.4,s.rotateImg.style.transform="rotate("+t+"deg)",s.rotateImg.dataset.deg=t},1e3/60))},stopRotate:function(){clearInterval(this.rotateTimer),this.rotateTimer=null},handleDrag:function(){this.drag=e.progress.drag(this.dragDom,this.frontBg);var s=this;this.drag.start=function(){e.audio.pause(),e.audio.status="pause",s.playDom.className="",s.stopRotate(),s.progress.stop()},this.drag.move=function(t){e.audio.playTo(t/100*s.musicData[s.index.nowIndex].duration),s.progress.changeNowProgress(t/100*s.musicData[s.index.nowIndex].duration)},this.drag.end=function(){e.audio.play(),e.audio.status="play",s.playDom.className="playing",s.rotate(),s.progress.start()}}},(new s).init()}(window.player||(window.player={}),document.getElementById("app"));